import{c as h,u as O,a as P,r as d,j as e,X as R,U}from"./index-DQ_HIcJs.js";import{l as A,e as D,m as k,n as I,o as T}from"./entryService-CdlEl31N.js";import{B as g}from"./Button-D8uAanOP.js";import{S as q}from"./save-D-ODLWQw.js";import{M as B}from"./mail-VrbEe_CD.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=h("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=h("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=h("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),G={happy:"üòÉ",neutral:"üòê",sad:"üòî",angry:"üò°",excited:"ü§©",calm:"üòå",anxious:"üò∞"};function W(){var j;const{currentUser:s}=O(),{language:w,setLanguage:y,t}=P(),[N,_]=d.useState(!0),[p,c]=d.useState(!1),[u,m]=d.useState(!1),f=d.useRef(null),[l,i]=d.useState({username:"",email:"",gender:"",phone:"",avatar_url:null}),[b,v]=d.useState({}),S=l.avatar_url||((j=s==null?void 0:s.user_metadata)==null?void 0:j.avatar_url)||"https://www.gravatar.com/avatar/00000000000000000000000000000000?d=mp&f=y";d.useEffect(()=>{s&&(C(),E())},[s]);const C=async()=>{try{const{data:a,error:r}=await A(s.id);r&&r.code!=="PGRST116"&&console.error("Error loading profile:",r),i(a?{username:a.username||"",email:s.email,gender:a.gender||"",phone:a.phone||"",avatar_url:a.avatar_url||null}:o=>{var n,x;return{...o,email:s.email,username:((n=s.user_metadata)==null?void 0:n.username)||((x=s.user_metadata)==null?void 0:x.full_name)||""}})}catch(a){console.error(a)}finally{_(!1)}},E=async()=>{try{const a=await D(s.id,!0),r={};a.forEach(o=>{if(o.mood){const n=o.mood.toLowerCase();r[n]=(r[n]||0)+1}}),v(r),v(r)}catch(a){console.error("Error calculating stats",a)}},L=async()=>{try{c(!0);const a={username:l.username,gender:l.gender,phone:l.phone,updated_at:new Date},{error:r}=await k(s.id,a);if(r)throw r;m(!1),alert(t("profile_updated"))}catch(a){alert(t("profile_error")+a.message)}finally{c(!1)}},M=async a=>{const r=a.target.files[0];if(r)try{c(!0);const o=await I(r,s.id);if(o){const{error:n}=await k(s.id,{avatar_url:o});if(n)throw n;i(x=>({...x,avatar_url:o}))}}catch(o){alert(t("avatar_error")+o.message)}finally{c(!1)}},z=async()=>{try{const a=await T(s.id);if(!a)return;const r=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),o=URL.createObjectURL(r),n=document.createElement("a");n.href=o,n.download=`diary_export_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}catch(a){console.error("Export failed:",a),alert("Failed to export data.")}};return N?e.jsx("div",{className:"p-8 text-center text-neutral-500",children:t("loading_profile")}):e.jsx("div",{className:"max-w-2xl mx-auto px-4 md:px-8",children:e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-3xl shadow-sm border border-neutral-100 dark:border-slate-700 overflow-hidden transition-colors",children:[e.jsx("div",{className:"h-32 bg-gradient-to-r from-indigo-500 to-purple-500"}),e.jsxs("div",{className:"px-8 pb-8",children:[e.jsxs("div",{className:"relative flex justify-between items-end -mt-12 mb-6",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"w-24 h-24 rounded-full border-4 border-white dark:border-slate-800 shadow-md overflow-hidden bg-white dark:bg-slate-700",children:e.jsx("img",{src:S,alt:"Profile",className:"w-full h-full object-cover"})}),e.jsx("button",{onClick:()=>{var a;return(a=f.current)==null?void 0:a.click()},className:"absolute bottom-0 right-0 bg-white dark:bg-slate-700 p-1.5 rounded-full shadow-md text-neutral-600 dark:text-slate-300 hover:text-indigo-600 dark:hover:text-indigo-400 transition-colors border border-neutral-100 dark:border-slate-600",title:t("change_avatar"),children:e.jsx(F,{size:16})}),e.jsx("input",{type:"file",ref:f,onChange:M,className:"hidden",accept:"image/*"})]}),e.jsx("div",{className:"mb-2",children:u?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(!1),className:"p-2 text-neutral-500 dark:text-slate-400 hover:bg-neutral-50 dark:hover:bg-slate-700 rounded-lg border border-transparent hover:border-neutral-200 dark:hover:border-slate-600",children:e.jsx(R,{size:20})}),e.jsx(g,{onClick:L,disabled:p,className:"bg-indigo-600 hover:bg-indigo-700 py-2 px-6 text-white shadow-md rounded-xl",children:p?t("saving"):e.jsxs(e.Fragment,{children:[e.jsx(q,{size:18,className:"mr-2"})," ",t("save_changes")]})})]}):e.jsx(g,{onClick:()=>m(!0),className:"bg-indigo-600 text-white hover:bg-indigo-700 shadow-md py-2 px-6 rounded-xl font-medium transition-all",children:t("edit_profile")})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-800 dark:text-white",children:l.username||"User"}),e.jsxs("p",{className:"text-neutral-500 dark:text-slate-400 flex items-center gap-1.5 text-sm mt-1",children:[e.jsx(B,{size:14})," ",l.email]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 pt-6 border-t border-neutral-100 dark:border-slate-700",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wider text-neutral-400 dark:text-slate-500",children:t("username_label")}),u?e.jsx("input",{type:"text",value:l.username,onChange:a=>i({...l,username:a.target.value}),className:"w-full p-3 rounded-xl bg-neutral-50 dark:bg-slate-900 border-transparent focus:bg-white dark:focus:bg-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900/50 outline-none transition-all font-medium text-neutral-700 dark:text-slate-200"}):e.jsxs("div",{className:"p-3 bg-neutral-50 dark:bg-slate-900 rounded-xl text-neutral-700 dark:text-slate-300 font-medium flex items-center gap-2",children:[e.jsx(U,{size:18,className:"text-neutral-400 dark:text-slate-500"}),l.username||"-"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wider text-neutral-400 dark:text-slate-500",children:t("gender_label")}),u?e.jsxs("select",{value:l.gender,onChange:a=>i({...l,gender:a.target.value}),className:"w-full p-3 rounded-xl bg-neutral-50 dark:bg-slate-900 border-transparent focus:bg-white dark:focus:bg-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900/50 outline-none transition-all font-medium text-neutral-700 dark:text-slate-200",children:[e.jsx("option",{value:"",children:t("select_gender")}),e.jsx("option",{value:"Male",children:t("male")}),e.jsx("option",{value:"Female",children:t("female")}),e.jsx("option",{value:"Other",children:t("other")})]}):e.jsx("div",{className:"p-3 bg-neutral-50 dark:bg-slate-900 rounded-xl text-neutral-700 dark:text-slate-300 font-medium",children:l.gender||"-"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-semibold uppercase tracking-wider text-neutral-400 dark:text-slate-500",children:t("phone_label")}),u?e.jsx("input",{type:"tel",value:l.phone,onChange:a=>i({...l,phone:a.target.value}),placeholder:"+1 234 567 890",className:"w-full p-3 rounded-xl bg-neutral-50 dark:bg-slate-900 border-transparent focus:bg-white dark:focus:bg-slate-800 focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200 dark:focus:ring-indigo-900/50 outline-none transition-all font-medium text-neutral-700 dark:text-slate-200"}):e.jsxs("div",{className:"p-3 bg-neutral-50 dark:bg-slate-900 rounded-xl text-neutral-700 dark:text-slate-300 font-medium flex items-center gap-2",children:[e.jsx(J,{size:18,className:"text-neutral-400 dark:text-slate-500"}),l.phone||"-"]})]})]})]}),e.jsxs("div",{className:"pt-6 border-t border-neutral-100 dark:border-slate-700",children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-white mb-4",children:t("mood_analytics")||"Mood Analytics"}),e.jsx("div",{className:"flex flex-wrap gap-4",children:Object.entries(b).length>0?Object.entries(b).map(([a,r])=>e.jsxs("div",{className:"flex items-center gap-2 bg-neutral-50 dark:bg-slate-900 px-4 py-2 rounded-xl",children:[e.jsx("span",{className:"text-2xl",children:G[a]||"‚ùì"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-neutral-500 dark:text-slate-400 capitalize",children:a}),e.jsx("span",{className:"text-lg font-bold text-neutral-800 dark:text-white",children:r})]})]},a)):e.jsx("p",{className:"text-sm text-neutral-400 dark:text-slate-500 italic",children:"No mood data yet."})})]}),e.jsxs("div",{className:"pt-6 border-t border-neutral-100 dark:border-slate-700 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-white",children:t("language")}),e.jsxs("select",{value:w,onChange:a=>y(a.target.value),className:"bg-neutral-50 dark:bg-slate-700 text-neutral-700 dark:text-slate-200 border border-neutral-200 dark:border-slate-600 rounded-lg py-2 px-3 text-sm focus:ring-2 focus:ring-indigo-500 outline-none",children:[e.jsx("option",{value:"en",children:"English"}),e.jsx("option",{value:"ta",children:"‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)"}),e.jsx("option",{value:"ml",children:"‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)"}),e.jsx("option",{value:"te",children:"‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)"}),e.jsx("option",{value:"kn",children:"‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)"})]})]}),e.jsx("h3",{className:"text-sm font-semibold text-neutral-900 dark:text-white",children:t("account_actions")}),e.jsxs(g,{onClick:z,className:"w-full sm:w-auto bg-neutral-50 dark:bg-slate-700 text-neutral-700 dark:text-slate-200 hover:bg-neutral-100 dark:hover:bg-slate-600 hover:text-indigo-600 dark:hover:text-indigo-400 border border-neutral-200 dark:border-slate-600 py-2.5 px-4 rounded-xl text-sm font-medium flex items-center justify-center gap-2 transition-all",children:[e.jsx(H,{size:18}),t("export_data")]})]})]})]})})}export{W as default};

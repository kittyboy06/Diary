import{c as A,j as e,X as E,r as a,d as Y,u as ge,a as be,f as ve,t as i}from"./index-DQ_HIcJs.js";import{c as ke,e as je,b as we,s as B,h as ye,i as Ne,j as Se,f as Pe,t as Ce}from"./entryService-CdlEl31N.js";import{S as Ee,E as Fe,a as Le,b as Ie}from"./SecureImage-B7h4RRPc.js";import{A as ee}from"./index--W1AxoUr.js";import{m as O}from"./proxy-_O7j-Vtr.js";import{F as C}from"./folder-DF_W8vsx.js";import{P as W,T as ze}from"./trash-2-M-jR35lL.js";import{P as De}from"./pen-C_koZWRn.js";import{f as _e}from"./format-mVbgGZla.js";import"./calendar-CK67t8Mz.js";import"./save-D-ODLWQw.js";import"./Skeleton-DMHLTjM5.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=A("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=A("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=A("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),Me=({isOpen:n,onClose:p,onConfirm:o,title:h,message:c,confirmText:u="Delete",confirmColor:d="bg-red-600"})=>n?e.jsx(ee,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-2xl w-full max-w-md p-6 shadow-xl border border-neutral-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-red-500",children:[e.jsx("div",{className:"bg-red-100 dark:bg-red-900/30 p-2 rounded-full",children:e.jsx(Ue,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-neutral-800 dark:text-white",children:h})]}),e.jsx("button",{onClick:p,className:"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200",children:e.jsx(E,{size:20})})]}),e.jsx("p",{className:"text-neutral-600 dark:text-slate-300 mb-8",children:c}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:p,className:"px-4 py-2 rounded-xl text-neutral-600 dark:text-slate-300 hover:bg-neutral-100 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>{o(),p()},className:`px-4 py-2 rounded-xl text-white font-medium ${d} hover:opacity-90 transition-opacity`,children:u})]})]})})}):null,Te=({isOpen:n,onClose:p,onConfirm:o})=>{const[h,c]=a.useState("");if(!n)return null;const u=d=>{d.preventDefault(),o(h),c("")};return e.jsx(ee,{children:e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white dark:bg-slate-800 rounded-2xl w-full max-w-md p-6 shadow-xl border border-neutral-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-indigo-500",children:[e.jsx("div",{className:"bg-indigo-100 dark:bg-indigo-900/30 p-2 rounded-full",children:e.jsx(Y,{size:24})}),e.jsx("h3",{className:"text-xl font-bold text-neutral-800 dark:text-white",children:"Reset PIN"})]}),e.jsx("button",{onClick:p,className:"text-neutral-400 hover:text-neutral-600 dark:hover:text-neutral-200",children:e.jsx(E,{size:20})})]}),e.jsx("p",{className:"text-neutral-600 dark:text-slate-300 mb-6",children:"Enter your account password to verify your identity and reset your PIN."}),e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsx("div",{children:e.jsx("input",{type:"password",placeholder:"Account Password",value:h,onChange:d=>c(d.target.value),className:"w-full px-4 py-2 rounded-xl border border-neutral-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-neutral-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none",required:!0})}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:p,className:"px-4 py-2 rounded-xl text-neutral-600 dark:text-slate-300 hover:bg-neutral-100 dark:hover:bg-slate-700 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 rounded-xl text-white font-medium bg-indigo-600 hover:bg-indigo-700 transition-colors",children:"Verify & Reset"})]})]})]})})})},We=()=>{var X,Z;const{currentUser:n,signIn:p}=ge(),{t:o}=be(),h=ve(),[c,u]=a.useState(((X=h.state)==null?void 0:X.unlocked)||!1),[d,j]=a.useState(""),[te,U]=a.useState(null),[se,M]=a.useState(!0),[f,T]=a.useState(!1),[g,v]=a.useState([]),[N,F]=a.useState([]),[m,S]=a.useState(((Z=h.state)==null?void 0:Z.folderId)||"Uncategorized"),[L,R]=a.useState(!1),[re,I]=a.useState(!1),[z,ae]=a.useState(""),[k,P]=a.useState({isOpen:!1,type:null,id:null}),[oe,D]=a.useState(!1),[$,q]=a.useState(null),[_,V]=a.useState(""),[w,G]=a.useState(0),[le,K]=a.useState(!0),[Q,ne]=a.useState(new Set),H=10;a.useEffect(()=>{n!=null&&n.id&&J()},[n]),a.useEffect(()=>{if(!c)return;let t;const s=()=>{u(!1),j(""),i.info("Secret Log locked due to inactivity")},r=()=>{t&&clearTimeout(t),t=setTimeout(s,6e4)};window.addEventListener("mousemove",r),window.addEventListener("keypress",r),window.addEventListener("click",r),window.addEventListener("scroll",r),window.addEventListener("touchstart",r);const x=()=>{document.hidden&&(u(!1),j(""))};return document.addEventListener("visibilitychange",x),r(),()=>{t&&clearTimeout(t),window.removeEventListener("mousemove",r),window.removeEventListener("keypress",r),window.removeEventListener("click",r),window.removeEventListener("scroll",r),window.removeEventListener("touchstart",r),document.removeEventListener("visibilitychange",x)}},[c]);const J=async()=>{M(!0);const t=await ke(n.id);U(t),T(!t),M(!1)},ie=async t=>{if(t.preventDefault(),f){if(d.length<4){i.error("PIN must be at least 4 digits");return}try{await B(n.id,d),U(d),T(!1),u(!0),y(!0),i.success("PIN Set Successfully!")}catch(s){console.error(s),i.error("Failed to set PIN")}}else d===te?(u(!0),y(!0)):(i.error("Incorrect PIN"),j(""))},de=async t=>{P({isOpen:!0,type:"entry",id:t})},ce=async()=>{const{type:t,id:s}=k;if(t==="entry")await Se(s),v(g.filter(r=>r.id!==s)),i.success("Secret deleted");else if(t==="folder"){const r=Pe(s);i.promise(r,{loading:"Deleting folder...",success:()=>(F(N.filter(x=>x.id!==s)),m===s&&S(null),"Folder deleted"),error:"Failed to delete folder"})}P({...k,isOpen:!1})},xe=async(t,s)=>{const r=Ne(t,s);i.promise(r,{loading:"Updating secret...",success:x=>(v(g.map(l=>l.id===t?{...l,...s,date:s.date?{toDate:()=>new Date(s.date)}:l.date,folder:s.folderId?N.find(b=>b.id===s.folderId):null,folderId:s.folderId}:l)),m&&m!=="Uncategorized"&&s.folderId&&s.folderId!==m&&v(l=>l.filter(b=>b.id!==t)),"Secret updated!"),error:"Failed to update"})},ue=async(t,s)=>{t.stopPropagation();const r=!s.isFavorite,x=g.map(l=>l.id===s.id?{...l,isFavorite:r}:l).sort((l,b)=>l.isFavorite===b.isFavorite?b.date.toDate()-l.date.toDate():b.isFavorite?1:-1);v(x);try{await Ce(s.id,r)}catch(l){console.error("Failed to toggle favorite:",l),i.error("Failed to update favorite"),y(!0)}},me=t=>{ne(s=>{const r=new Set(s);return r.has(t)?r.delete(t):r.add(t),r})};a.useEffect(()=>{c&&y(!0)},[m]);const y=async(t=!1)=>{if(n){t&&(R(!0),v([]),G(0),K(!0));try{const s=t?0:w,[r,x]=await Promise.all([je(n.id,!0,m,s,H,!0),t?we(n.id,!0):Promise.resolve(null)]);v(l=>t?r:[...l,...r]),r.length<H&&K(!1),t&&x&&F(x||[])}catch(s){console.error(s),i.error("Failed to load secret data")}finally{R(!1)}}},pe=()=>{G(t=>t+1)};a.useEffect(()=>{w>0&&c&&y(!1)},[w]);const he=async t=>{if(t.preventDefault(),!_.trim())return;const s=ye(n.id,_,"red",!0);i.promise(s,{loading:"Creating secret folder...",success:r=>(F([...N,r]),V(""),I(!1),"Secret folder created!"),error:"Failed to create folder"})},fe=async(t,s)=>{s.stopPropagation(),P({isOpen:!0,type:"folder",id:t})};return se?e.jsx("div",{className:"p-10 text-center text-neutral-500",children:"Checking Security..."}):c?e.jsxs("div",{className:"space-y-8 border-t-4 border-rose-500 pt-8 max-w-5xl mx-auto px-4 md:px-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h1",{className:"text-3xl font-bold text-rose-800 dark:text-rose-400 flex items-center gap-3",children:[e.jsx(Oe,{size:32}),o("secret_log")]}),e.jsx("button",{onClick:()=>u(!1),className:"text-sm text-neutral-500 dark:text-slate-400 hover:text-neutral-800 dark:hover:text-slate-200 underline",children:o("lock_again")})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",placeholder:o("search_placeholder"),value:z,onChange:t=>ae(t.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-rose-200 dark:border-rose-900/50 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-rose-500 outline-none transition-all placeholder-neutral-400 dark:placeholder-slate-500"}),e.jsx("div",{className:"absolute left-3 top-3.5 text-neutral-400 dark:text-slate-500",children:e.jsx(Ee,{size:18})})]}),e.jsxs("div",{className:"flex items-center space-x-3 overflow-x-auto pb-4 scrollbar-hide",children:[e.jsxs("button",{onClick:()=>S("Uncategorized"),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${m==="Uncategorized"?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[e.jsx(C,{size:18}),e.jsx("span",{children:"General"})]}),N.map(t=>e.jsxs("div",{onClick:()=>S(t.id),className:`group relative flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all cursor-pointer ${m===t.id?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[e.jsx(C,{size:18}),e.jsx("span",{children:t.name}),e.jsx("button",{onClick:s=>fe(t.id,s),className:"ml-2 opacity-0 group-hover:opacity-100 hover:text-rose-300 transition-opacity",children:e.jsx(E,{size:14})})]},t.id)),e.jsxs("button",{onClick:()=>S(null),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${m===null?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[e.jsx(C,{size:18}),e.jsx("span",{children:"All Secrets"})]}),re?e.jsxs("form",{onSubmit:he,className:"flex items-center space-x-2 bg-rose-50 dark:bg-slate-800 px-3 py-2 rounded-xl border border-rose-200 dark:border-rose-900/50",children:[e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Secret Folder",value:_,onChange:t=>V(t.target.value),className:"bg-transparent border-none focus:ring-0 p-0 text-sm text-rose-800 dark:text-rose-200 w-32 placeholder-rose-400"}),e.jsx("button",{type:"submit",className:"text-rose-600 dark:text-rose-400",children:e.jsx(W,{size:18})}),e.jsx("button",{type:"button",onClick:()=>I(!1),className:"text-rose-400 hover:text-rose-600",children:e.jsx(E,{size:18})})]}):e.jsxs("button",{onClick:()=>I(!0),className:"flex items-center space-x-2 px-4 py-2 rounded-xl border border-dashed border-rose-300 dark:border-rose-700 text-rose-500 dark:text-rose-400 hover:border-rose-400 hover:text-rose-600 transition-all whitespace-nowrap",children:[e.jsx(W,{size:18}),e.jsx("span",{children:"New Folder"})]})]}),e.jsx(Fe,{isOpen:!!$,onClose:()=>q(null),entry:$,onSave:xe}),e.jsx(Me,{isOpen:k.isOpen,onClose:()=>P({...k,isOpen:!1}),onConfirm:ce,title:k.type==="folder"?"Delete Folder?":"Delete Secret?",message:k.type==="folder"?"Are you sure you want to delete this folder? All secrets within it will be moved to general.":"Are you sure you want to delete this secret entry? This action cannot be undone."}),L&&!g.length&&w===0?e.jsx("p",{className:"text-neutral-500 dark:text-slate-400",children:"Loading secrets..."}):e.jsxs("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:[g.filter(t=>{var s,r;return(((s=t.title)==null?void 0:s.toLowerCase())||"").includes(z.toLowerCase())||(((r=t.content)==null?void 0:r.toLowerCase())||"").includes(z.toLowerCase())}).map((t,s)=>e.jsxs(O.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},className:"bg-rose-50/50 dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-rose-100 dark:border-rose-900/30 relative group flex flex-col h-full min-h-[250px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-rose-900 dark:text-rose-100 line-clamp-1",title:t.title,children:t.title}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsx("p",{className:"text-sm text-rose-400 dark:text-rose-300 font-medium",children:t.date?_e(t.date.toDate(),"PPP"):"Just now"}),t.folder&&e.jsxs("span",{className:"text-xs bg-rose-100 dark:bg-rose-900/50 text-rose-600 dark:text-rose-300 px-2 py-0.5 rounded-full flex items-center gap-1 line-clamp-1 max-w-[100px]",children:[e.jsx(C,{size:10}),t.folder.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:r=>ue(r,t),className:`p-1.5 rounded-full transition-colors ${t.isFavorite?"text-amber-400 hover:text-amber-500 bg-amber-50 dark:bg-amber-900/20":"text-rose-300 dark:text-rose-600 hover:text-amber-400 hover:bg-amber-50 dark:hover:bg-slate-700"}`,title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(Le,{size:16,fill:t.isFavorite?"currentColor":"none"})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),q(t)},className:"text-rose-300 hover:text-rose-600 p-1.5 transition-colors opacity-0 group-hover:opacity-100",title:"Edit Secret",children:e.jsx(De,{size:16})}),e.jsx("button",{onClick:r=>{r.stopPropagation(),de(t.id)},className:"text-rose-300 hover:text-rose-600 p-1.5 transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(ze,{size:16})})]})]}),e.jsxs("div",{onClick:()=>me(t.id),className:"whitespace-pre-wrap text-rose-900/80 dark:text-slate-300 leading-relaxed font-serif cursor-pointer flex-1",children:[e.jsx("p",{className:Q.has(t.id)?"":"line-clamp-6",children:t.content}),!Q.has(t.id)&&t.content.length>150&&e.jsx("span",{className:"text-rose-500 text-sm font-medium hover:underline mt-1 block",children:"Read more"})]}),t.imageUrl&&e.jsx("div",{className:"mt-4 rounded-lg overflow-hidden h-40 w-full bg-rose-100 dark:bg-slate-900 shrink-0",children:e.jsx(Ie,{path:t.imageUrl,alt:"Secret info",className:"w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity"})})]},t.id)),g.length===0&&e.jsx("p",{className:"text-center text-rose-400 dark:text-rose-500 py-10 col-span-full",children:o("no_entries")})]}),le&&!L&&g.length>0&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("button",{onClick:pe,className:"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 px-6 py-2 rounded-full border border-rose-200 dark:border-rose-900/50 hover:bg-rose-100 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Load More Secrets"})}),L&&w>0&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("p",{className:"text-rose-400",children:"Loading..."})})]}):e.jsxs("div",{className:"max-w-md mx-auto py-20 text-center",children:[e.jsx("div",{className:"bg-rose-100 dark:bg-rose-900/30 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600 dark:text-rose-400",children:f?e.jsx(Ae,{size:40}):e.jsx(Y,{size:40})}),e.jsx("h2",{className:"text-2xl font-bold text-neutral-800 dark:text-white mb-2",children:o(f?"set_pin_title":"locked_title")}),e.jsx("p",{className:"text-neutral-500 dark:text-slate-400 mb-8",children:o(f?"set_pin_msg":"locked_msg")}),e.jsxs("form",{onSubmit:ie,className:"flex justify-center gap-4",children:[e.jsx("input",{type:"password",maxLength:6,placeholder:o(f?"new_pin_placeholder":"pin_placeholder"),className:"w-32 text-center text-2xl tracking-widest p-3 rounded-xl border border-neutral-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-rose-500 focus:border-rose-500 outline-none transition-all placeholder-neutral-300 dark:placeholder-slate-600",value:d,onChange:t=>j(t.target.value),autoFocus:!0}),e.jsx("button",{type:"submit",className:"bg-rose-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-rose-700 transition-colors shadow-lg shadow-rose-200 dark:shadow-rose-900/20",children:o(f?"set_pin":"unlock")})]}),!f&&e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>D(!0),className:"text-xs text-neutral-400 dark:text-slate-500 hover:text-neutral-600 dark:hover:text-slate-300 underline transition-colors",children:o("forgot_pin")})}),e.jsx(Te,{isOpen:oe,onClose:()=>D(!1),onConfirm:async t=>{try{const{error:s}=await p(n.email,t);s?i.error("Incorrect password"):(await B(n.id,null),J(),j(""),D(!1),i.success("PIN reset successfully"))}catch(s){console.error(s),i.error("Authentication failed")}}})]})};export{We as default};

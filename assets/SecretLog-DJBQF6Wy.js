import{c as J,u as de,a as ce,f as xe,r as a,t as b,j as t,d as ue,X as Q}from"./index-CHzR-8ww.js";import{c as pe,e as me,b as he,s as q,f as fe,h as ge,i as be,t as ke,j as we}from"./entryService-D353WhkT.js";import{S as ve,E as je,a as Ne,b as ye}from"./SecureImage-D-CSwIWl.js";import{F as w}from"./folder-CZgyDXM9.js";import{P as H,T as Se}from"./trash-2-RTgWVYMQ.js";import{m as Fe}from"./proxy-itqZaXMe.js";import{P as Pe}from"./pen-BRQGpQJe.js";import{f as Ce}from"./format-mVbgGZla.js";import"./index-vA4RPWVM.js";import"./calendar-C847GZGj.js";import"./save-Cx3ikS70.js";import"./Skeleton-6teEfq3M.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=J("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=J("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]),Ke=()=>{var G,K;const{currentUser:i,signIn:V}=de(),{t:l}=ce(),E=xe(),[v,j]=a.useState(((G=E.state)==null?void 0:G.unlocked)||!1),[m,N]=a.useState(""),[X,I]=a.useState(null),[Z,L]=a.useState(!0),[d,z]=a.useState(!1),[c,p]=a.useState([]),[h,y]=a.useState([]),[n,k]=a.useState(((K=E.state)==null?void 0:K.folderId)||"Uncategorized"),[S,_]=a.useState(!1),[B,F]=a.useState(!1),[P,W]=a.useState(""),[D,U]=a.useState(null),[C,M]=a.useState(""),[f,A]=a.useState(0),[Y,R]=a.useState(!0),[T,ee]=a.useState(new Set),$=10;a.useEffect(()=>{i!=null&&i.id&&O()},[i]);const O=async()=>{L(!0);const e=await pe(i.id);I(e),z(!e),L(!1)},te=async e=>{if(e.preventDefault(),d){if(m.length<4){alert("PIN must be at least 4 digits");return}try{await q(i.id,m),I(m),z(!1),j(!0),g(!0),alert("PIN Set Successfully!")}catch(s){console.error(s),alert("Failed to set PIN")}}else m===X?(j(!0),g(!0)):(alert("Incorrect PIN"),N(""))},se=async e=>{window.confirm(l("delete_confirm"))&&(await we(e),p(c.filter(s=>s.id!==e)))},re=async(e,s)=>{const r=be(e,s);b.promise(r,{loading:"Updating secret...",success:x=>(p(c.map(o=>o.id===e?{...o,...s,date:s.date?{toDate:()=>new Date(s.date)}:o.date,folder:s.folderId?h.find(u=>u.id===s.folderId):null,folderId:s.folderId}:o)),n&&n!=="Uncategorized"&&s.folderId&&s.folderId!==n&&p(o=>o.filter(u=>u.id!==e)),"Secret updated!"),error:"Failed to update"})},ae=async(e,s)=>{e.stopPropagation();const r=!s.isFavorite,x=c.map(o=>o.id===s.id?{...o,isFavorite:r}:o).sort((o,u)=>o.isFavorite===u.isFavorite?u.date.toDate()-o.date.toDate():u.isFavorite?1:-1);p(x);try{await ke(s.id,r)}catch(o){console.error("Failed to toggle favorite:",o),b.error("Failed to update favorite"),g(!0)}},oe=e=>{ee(s=>{const r=new Set(s);return r.has(e)?r.delete(e):r.add(e),r})};a.useEffect(()=>{v&&g(!0)},[n]);const g=async(e=!1)=>{if(i){e&&(_(!0),p([]),A(0),R(!0));try{const s=e?0:f,[r,x]=await Promise.all([me(i.id,!0,n,s,$,!0),e?he(i.id,!0):Promise.resolve(null)]);p(o=>e?r:[...o,...r]),r.length<$&&R(!1),e&&x&&y(x||[])}catch(s){console.error(s),b.error("Failed to load secret data")}finally{_(!1)}}},le=()=>{A(e=>e+1)};a.useEffect(()=>{f>0&&v&&g(!1)},[f]);const ie=async e=>{if(e.preventDefault(),!C.trim())return;const s=ge(i.id,C,"red",!0);b.promise(s,{loading:"Creating secret folder...",success:r=>(y([...h,r]),M(""),F(!1),"Secret folder created!"),error:"Failed to create folder"})},ne=async(e,s)=>{if(s.stopPropagation(),!window.confirm("Delete this folder? Entries will be unassigned."))return;const r=fe(e);b.promise(r,{loading:"Deleting folder...",success:()=>(y(h.filter(x=>x.id!==e)),n===e&&k(null),"Folder deleted"),error:"Failed to delete folder"})};return Z?t.jsx("div",{className:"p-10 text-center text-neutral-500",children:"Checking Security..."}):v?t.jsxs("div",{className:"space-y-8 border-t-4 border-rose-500 pt-8 max-w-5xl mx-auto px-4 md:px-8",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("h1",{className:"text-3xl font-bold text-rose-800 dark:text-rose-400 flex items-center gap-3",children:[t.jsx(Ie,{size:32}),l("secret_log")]}),t.jsx("button",{onClick:()=>j(!1),className:"text-sm text-neutral-500 dark:text-slate-400 hover:text-neutral-800 dark:hover:text-slate-200 underline",children:l("lock_again")})]}),t.jsxs("div",{className:"relative",children:[t.jsx("input",{type:"text",placeholder:l("search_placeholder"),value:P,onChange:e=>W(e.target.value),className:"w-full pl-10 pr-4 py-3 rounded-xl border border-rose-200 dark:border-rose-900/50 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-rose-500 outline-none transition-all placeholder-neutral-400 dark:placeholder-slate-500"}),t.jsx("div",{className:"absolute left-3 top-3.5 text-neutral-400 dark:text-slate-500",children:t.jsx(ve,{size:18})})]}),t.jsxs("div",{className:"flex items-center space-x-3 overflow-x-auto pb-4 scrollbar-hide",children:[t.jsxs("button",{onClick:()=>k("Uncategorized"),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${n==="Uncategorized"?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[t.jsx(w,{size:18}),t.jsx("span",{children:"General"})]}),h.map(e=>t.jsxs("div",{onClick:()=>k(e.id),className:`group relative flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all cursor-pointer ${n===e.id?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[t.jsx(w,{size:18}),t.jsx("span",{children:e.name}),t.jsx("button",{onClick:s=>ne(e.id,s),className:"ml-2 opacity-0 group-hover:opacity-100 hover:text-rose-300 transition-opacity",children:t.jsx(Q,{size:14})})]},e.id)),t.jsxs("button",{onClick:()=>k(null),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${n===null?"bg-rose-600 text-white shadow-md":"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 hover:bg-rose-100 dark:hover:bg-slate-700"}`,children:[t.jsx(w,{size:18}),t.jsx("span",{children:"All Secrets"})]}),B?t.jsxs("form",{onSubmit:ie,className:"flex items-center space-x-2 bg-rose-50 dark:bg-slate-800 px-3 py-2 rounded-xl border border-rose-200 dark:border-rose-900/50",children:[t.jsx("input",{autoFocus:!0,type:"text",placeholder:"Secret Folder",value:C,onChange:e=>M(e.target.value),className:"bg-transparent border-none focus:ring-0 p-0 text-sm text-rose-800 dark:text-rose-200 w-32 placeholder-rose-400"}),t.jsx("button",{type:"submit",className:"text-rose-600 dark:text-rose-400",children:t.jsx(H,{size:18})}),t.jsx("button",{type:"button",onClick:()=>F(!1),className:"text-rose-400 hover:text-rose-600",children:t.jsx(Q,{size:18})})]}):t.jsxs("button",{onClick:()=>F(!0),className:"flex items-center space-x-2 px-4 py-2 rounded-xl border border-dashed border-rose-300 dark:border-rose-700 text-rose-500 dark:text-rose-400 hover:border-rose-400 hover:text-rose-600 transition-all whitespace-nowrap",children:[t.jsx(H,{size:18}),t.jsx("span",{children:"New Folder"})]})]}),t.jsx(je,{isOpen:!!D,onClose:()=>U(null),entry:D,folders:h,onSave:re}),S&&!c.length&&f===0?t.jsx("p",{className:"text-neutral-500 dark:text-slate-400",children:"Loading secrets..."}):t.jsxs("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:[c.filter(e=>{var s,r;return(((s=e.title)==null?void 0:s.toLowerCase())||"").includes(P.toLowerCase())||(((r=e.content)==null?void 0:r.toLowerCase())||"").includes(P.toLowerCase())}).map((e,s)=>t.jsxs(Fe.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:s*.1},className:"bg-rose-50/50 dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-rose-100 dark:border-rose-900/30 relative group flex flex-col h-full min-h-[250px]",children:[t.jsxs("div",{className:"flex justify-between items-start mb-4",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl font-bold text-rose-900 dark:text-rose-100 line-clamp-1",title:e.title,children:e.title}),t.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[t.jsx("p",{className:"text-sm text-rose-400 dark:text-rose-300 font-medium",children:e.date?Ce(e.date.toDate(),"PPP"):"Just now"}),e.folder&&t.jsxs("span",{className:"text-xs bg-rose-100 dark:bg-rose-900/50 text-rose-600 dark:text-rose-300 px-2 py-0.5 rounded-full flex items-center gap-1 line-clamp-1 max-w-[100px]",children:[t.jsx(w,{size:10}),e.folder.name]})]})]}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx("button",{onClick:r=>ae(r,e),className:`p-1.5 rounded-full transition-colors ${e.isFavorite?"text-amber-400 hover:text-amber-500 bg-amber-50 dark:bg-amber-900/20":"text-rose-300 dark:text-rose-600 hover:text-amber-400 hover:bg-amber-50 dark:hover:bg-slate-700"}`,title:e.isFavorite?"Remove from favorites":"Add to favorites",children:t.jsx(Ne,{size:16,fill:e.isFavorite?"currentColor":"none"})}),t.jsx("button",{onClick:r=>{r.stopPropagation(),U(e)},className:"text-rose-300 hover:text-rose-600 p-1.5 transition-colors opacity-0 group-hover:opacity-100",title:"Edit Secret",children:t.jsx(Pe,{size:16})}),t.jsx("button",{onClick:r=>{r.stopPropagation(),se(e.id)},className:"text-rose-300 hover:text-rose-600 p-1.5 transition-colors opacity-0 group-hover:opacity-100",children:t.jsx(Se,{size:16})})]})]}),t.jsxs("div",{onClick:()=>oe(e.id),className:"whitespace-pre-wrap text-rose-900/80 dark:text-slate-300 leading-relaxed font-serif cursor-pointer flex-1",children:[t.jsx("p",{className:T.has(e.id)?"":"line-clamp-6",children:e.content}),!T.has(e.id)&&e.content.length>150&&t.jsx("span",{className:"text-rose-500 text-sm font-medium hover:underline mt-1 block",children:"Read more"})]}),e.imageUrl&&t.jsx("div",{className:"mt-4 rounded-lg overflow-hidden h-40 w-full bg-rose-100 dark:bg-slate-900 shrink-0",children:t.jsx(ye,{path:e.imageUrl,alt:"Secret info",className:"w-full h-full object-cover opacity-90 hover:opacity-100 transition-opacity"})})]},e.id)),c.length===0&&t.jsx("p",{className:"text-center text-rose-400 dark:text-rose-500 py-10 col-span-full",children:l("no_entries")})]}),Y&&!S&&c.length>0&&t.jsx("div",{className:"flex justify-center pt-6",children:t.jsx("button",{onClick:le,className:"bg-rose-50 dark:bg-slate-800 text-rose-600 dark:text-rose-400 px-6 py-2 rounded-full border border-rose-200 dark:border-rose-900/50 hover:bg-rose-100 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Load More Secrets"})}),S&&f>0&&t.jsx("div",{className:"flex justify-center pt-6",children:t.jsx("p",{className:"text-rose-400",children:"Loading..."})})]}):t.jsxs("div",{className:"max-w-md mx-auto py-20 text-center",children:[t.jsx("div",{className:"bg-rose-100 dark:bg-rose-900/30 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6 text-rose-600 dark:text-rose-400",children:d?t.jsx(Ee,{size:40}):t.jsx(ue,{size:40})}),t.jsx("h2",{className:"text-2xl font-bold text-neutral-800 dark:text-white mb-2",children:l(d?"set_pin_title":"locked_title")}),t.jsx("p",{className:"text-neutral-500 dark:text-slate-400 mb-8",children:l(d?"set_pin_msg":"locked_msg")}),t.jsxs("form",{onSubmit:te,className:"flex justify-center gap-4",children:[t.jsx("input",{type:"password",maxLength:6,placeholder:l(d?"new_pin_placeholder":"pin_placeholder"),className:"w-32 text-center text-2xl tracking-widest p-3 rounded-xl border border-neutral-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-rose-500 focus:border-rose-500 outline-none transition-all placeholder-neutral-300 dark:placeholder-slate-600",value:m,onChange:e=>N(e.target.value),autoFocus:!0}),t.jsx("button",{type:"submit",className:"bg-rose-600 text-white px-6 py-3 rounded-xl font-medium hover:bg-rose-700 transition-colors shadow-lg shadow-rose-200 dark:shadow-rose-900/20",children:l(d?"set_pin":"unlock")})]}),!d&&t.jsx("div",{className:"mt-6",children:t.jsx("button",{onClick:async()=>{const e=prompt("To reset your PIN, please enter your account login password:");if(e)try{const{error:s}=await V(i.email,e);s?alert("Incorrect password. Cannot reset PIN."):window.confirm("Password verified. Reset PIN now?")&&(await q(i.id,null),O(),N(""),alert("PIN has been reset. Please set a new one."))}catch(s){console.error(s),alert("Authentication failed.")}},className:"text-xs text-neutral-400 dark:text-slate-500 hover:text-neutral-600 dark:hover:text-slate-300 underline transition-colors",children:l("forgot_pin")})})]})};export{Ke as default};

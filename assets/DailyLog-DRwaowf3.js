import{u as W,a as Y,f as ee,r as l,j as e,X as _,d as te,t as p}from"./index-CHzR-8ww.js";import{e as ae,b as se,f as re,h as le,i as oe,t as ie,j as ne}from"./entryService-D353WhkT.js";import{S as i}from"./Skeleton-6teEfq3M.js";import{S as de,E as ce,a as xe,b as ue}from"./SecureImage-D-CSwIWl.js";import{F as me}from"./filter-BS1xhOCK.js";import{F as g}from"./folder-CZgyDXM9.js";import{P as T,T as he}from"./trash-2-RTgWVYMQ.js";import{m as pe}from"./proxy-itqZaXMe.js";import{C as ge}from"./calendar-C847GZGj.js";import{P as fe}from"./pen-BRQGpQJe.js";import{f as be}from"./format-mVbgGZla.js";import"./index-vA4RPWVM.js";import"./save-Cx3ikS70.js";const Le=()=>{var I;const{currentUser:f}=W(),{t:c}=Y(),$=ee(),[x,u]=l.useState([]),[m,v]=l.useState([]),[n,b]=l.useState(((I=$.state)==null?void 0:I.folderId)||"Uncategorized"),[w,S]=l.useState(!0),[j,H]=l.useState(""),[N,O]=l.useState("All"),[R,k]=l.useState(!1),[E,C]=l.useState(null),[y,z]=l.useState(""),[h,P]=l.useState(0),[G,D]=l.useState(!0),[L,Q]=l.useState(new Set),A=10,M={happy:"ðŸ˜ƒ",neutral:"ðŸ˜",sad:"ðŸ˜”",angry:"ðŸ˜¡",excited:"ðŸ¤©",calm:"ðŸ˜Œ",anxious:"ðŸ˜°"},F=async(t=!1)=>{t&&(S(!0),u([]),P(0),D(!0));try{const a=t?0:h,[s,o]=await Promise.all([ae(f.id,!1,n,a,A),t?se(f.id,!1):Promise.resolve(null)]);s.length<A&&D(!1),u(r=>t?s:[...r,...s]),t&&o&&v(o)}catch(a){console.error(a),p.error("Failed to load data")}finally{S(!1)}},J=()=>{P(t=>t+1)};l.useEffect(()=>{h>0&&F(!1)},[h]),l.useEffect(()=>{F(!0)},[f,n]);const X=async t=>{if(t.preventDefault(),!y.trim())return;const a=le(f.id,y);p.promise(a,{loading:"Creating folder...",success:s=>(v([...m,s]),z(""),k(!1),"Folder created!"),error:"Failed to create folder"})},Z=async(t,a)=>{if(a.stopPropagation(),!window.confirm("Delete this folder? Entries in it will remain but be unassigned."))return;const s=re(t);p.promise(s,{loading:"Deleting folder...",success:()=>(v(m.filter(o=>o.id!==t)),n===t&&b(null),"Folder deleted"),error:"Failed to delete folder"})},q=async t=>{window.confirm(c("delete_confirm"))&&(await ne(t),u(x.filter(a=>a.id!==t)))},B=async(t,a)=>{const s=oe(t,a);p.promise(s,{loading:"Updating entry...",success:o=>(u(x.map(r=>r.id===t?{...r,...a,date:a.date?{toDate:()=>new Date(a.date)}:r.date,folder:a.folderId?m.find(d=>d.id===a.folderId):null,folderId:a.folderId}:r)),n&&n!=="Uncategorized"&&a.folderId&&a.folderId!==n&&u(r=>r.filter(d=>d.id!==t)),"Entry updated!"),error:"Failed to update entry"})},K=async(t,a)=>{t.stopPropagation();const s=!a.isFavorite,o=x.map(r=>r.id===a.id?{...r,isFavorite:s}:r).sort((r,d)=>r.isFavorite===d.isFavorite?d.date.toDate()-r.date.toDate():d.isFavorite?1:-1);u(o);try{await ie(a.id,s)}catch(r){console.error("Failed to toggle favorite:",r),p.error("Failed to update favorite"),F(!0)}},V=t=>{Q(a=>{const s=new Set(a);return s.has(t)?s.delete(t):s.add(t),s})},U=x.filter(t=>{var o,r;const a=(((o=t.title)==null?void 0:o.toLowerCase())||"").includes(j.toLowerCase())||(((r=t.content)==null?void 0:r.toLowerCase())||"").includes(j.toLowerCase()),s=N==="All"||t.mood===N;return a&&s});return w&&!x.length&&h===0?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsx(i,{className:"h-10 w-48 rounded-xl"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{className:"h-10 w-64 rounded-xl"}),e.jsx(i,{className:"h-10 w-32 rounded-xl"})]})]}),e.jsx("div",{className:"grid gap-6",children:[1,2,3].map(t=>e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-neutral-100 dark:border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-6 w-48 rounded-md"}),e.jsx(i,{className:"h-4 w-32 rounded-md"})]}),e.jsx(i,{className:"h-6 w-6 rounded-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-3/4"})]})]},t))})]}):e.jsxs("div",{className:"space-y-6 max-w-5xl mx-auto px-4 md:px-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-4 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-neutral-800 dark:text-white",children:c("daily_log")}),e.jsxs("div",{className:"flex gap-2 w-full md:w-auto",children:[e.jsxs("div",{className:"relative flex-1 md:w-64",children:[e.jsx("input",{type:"text",placeholder:c("search_placeholder"),value:j,onChange:t=>H(t.target.value),className:"w-full pl-10 pr-4 py-2 rounded-xl border border-neutral-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all placeholder-neutral-400 dark:placeholder-slate-500"}),e.jsx("div",{className:"absolute left-3 top-2.5 text-neutral-400 dark:text-slate-500",children:e.jsx(de,{size:18})})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:N,onChange:t=>O(t.target.value),className:"appearance-none pl-10 pr-8 py-2 rounded-xl border border-neutral-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-neutral-900 dark:text-white focus:ring-2 focus:ring-indigo-500 outline-none transition-all cursor-pointer",children:[e.jsx("option",{value:"All",children:c("all_moods")}),e.jsx("option",{value:"Happy",children:"Happy"}),e.jsx("option",{value:"Sad",children:"Sad"}),e.jsx("option",{value:"Excited",children:"Excited"}),e.jsx("option",{value:"Calm",children:"Calm"}),e.jsx("option",{value:"Anxious",children:"Anxious"})]}),e.jsx("div",{className:"absolute left-3 top-2.5 text-neutral-400 dark:text-slate-500 pointer-events-none",children:e.jsx(me,{size:18})})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 overflow-x-auto pb-4 scrollbar-hide",children:[e.jsxs("button",{onClick:()=>b("Uncategorized"),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${n==="Uncategorized"?"bg-indigo-600 text-white shadow-md":"bg-white dark:bg-slate-800 text-neutral-600 dark:text-slate-300 hover:bg-neutral-50 dark:hover:bg-slate-700"}`,children:[e.jsx(g,{size:18}),e.jsx("span",{children:"General"})]}),m.map(t=>e.jsxs("div",{onClick:()=>b(t.id),className:`group relative flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all cursor-pointer ${n===t.id?"bg-indigo-600 text-white shadow-md":"bg-white dark:bg-slate-800 text-neutral-600 dark:text-slate-300 hover:bg-neutral-50 dark:hover:bg-slate-700"}`,children:[e.jsx(g,{size:18}),e.jsx("span",{children:t.name}),e.jsx("button",{onClick:a=>Z(t.id,a),className:"ml-2 opacity-0 group-hover:opacity-100 hover:text-red-300 transition-opacity",children:e.jsx(_,{size:14})})]},t.id)),e.jsxs("button",{onClick:()=>b(null),className:`flex items-center space-x-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${n===null?"bg-indigo-600 text-white shadow-md":"bg-white dark:bg-slate-800 text-neutral-600 dark:text-slate-300 hover:bg-neutral-50 dark:hover:bg-slate-700"}`,children:[e.jsx(g,{size:18}),e.jsx("span",{children:"All Entries"})]}),R?e.jsxs("form",{onSubmit:X,className:"flex items-center space-x-2 bg-white dark:bg-slate-800 px-3 py-2 rounded-xl border border-indigo-200 dark:border-indigo-900/50",children:[e.jsx("input",{autoFocus:!0,type:"text",placeholder:"Folder Name",value:y,onChange:t=>z(t.target.value),className:"bg-transparent border-none focus:ring-0 p-0 text-sm text-neutral-800 dark:text-white w-32 placeholder-neutral-400"}),e.jsx("button",{type:"submit",className:"text-indigo-600 dark:text-indigo-400",children:e.jsx(T,{size:18})}),e.jsx("button",{type:"button",onClick:()=>k(!1),className:"text-neutral-400 hover:text-neutral-600",children:e.jsx(_,{size:18})})]}):e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center space-x-2 px-4 py-2 rounded-xl border border-dashed border-neutral-300 dark:border-slate-600 text-neutral-500 dark:text-slate-400 hover:border-indigo-400 hover:text-indigo-500 transition-all whitespace-nowrap",children:[e.jsx(T,{size:18}),e.jsx("span",{children:"New Folder"})]})]}),e.jsx(ce,{isOpen:!!E,onClose:()=>C(null),entry:E,folders:m,onSave:B}),U.length===0?e.jsxs("div",{className:"text-center py-20 bg-white dark:bg-slate-800 rounded-3xl border border-neutral-100 dark:border-slate-700",children:[e.jsx("div",{className:"bg-indigo-50 dark:bg-indigo-900/30 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600 dark:text-indigo-400",children:e.jsx(g,{size:32})}),e.jsx("h2",{className:"text-xl font-semibold text-neutral-800 dark:text-white",children:c("no_entries")}),e.jsx("p",{className:"text-neutral-500 dark:text-slate-400 mt-2",children:j?"Try adjusting your filters.":"This folder is empty."})]}):e.jsx("div",{className:"grid gap-6 grid-cols-1 md:grid-cols-2 lg:grid-cols-3",children:U.map((t,a)=>e.jsxs(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:a*.1},className:"bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm border border-neutral-100 dark:border-slate-700 hover:shadow-md transition-shadow relative group flex flex-col h-full min-h-[250px]",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-800 dark:text-white line-clamp-1",title:t.title,children:t.title||"Untitled"}),t.mood&&M[t.mood.toLowerCase()]&&e.jsx("span",{className:"text-xl",title:t.mood,children:M[t.mood.toLowerCase()]})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-1",children:[e.jsxs("p",{className:"text-sm text-neutral-400 dark:text-slate-500 font-medium flex items-center gap-2",children:[e.jsx(ge,{size:14}),t.date?be(t.date.toDate(),"PPP"):"Just now"]}),t.folder&&e.jsxs("span",{className:"text-xs bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 px-2 py-0.5 rounded-full flex items-center gap-1 line-clamp-1 max-w-[100px]",children:[e.jsx(g,{size:10}),t.folder.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:s=>K(s,t),className:`p-1.5 rounded-full transition-colors ${t.isFavorite?"text-amber-400 hover:text-amber-500 bg-amber-50 dark:bg-amber-900/20":"text-neutral-300 dark:text-slate-600 hover:text-amber-400 hover:bg-amber-50 dark:hover:bg-slate-700"}`,title:t.isFavorite?"Remove from favorites":"Add to favorites",children:e.jsx(xe,{size:16,fill:t.isFavorite?"currentColor":"none"})}),e.jsx("button",{onClick:s=>{s.stopPropagation(),C(t)},className:"text-neutral-300 hover:text-indigo-500 p-1.5 transition-colors opacity-0 group-hover:opacity-100",title:"Edit Entry",children:e.jsx(fe,{size:16})}),t.isSecret&&e.jsx(te,{className:"text-rose-400",size:16}),e.jsx("button",{onClick:s=>{s.stopPropagation(),q(t.id)},className:"text-neutral-300 hover:text-red-500 p-1.5 transition-colors opacity-0 group-hover:opacity-100",title:c("delete_confirm"),children:e.jsx(he,{size:16})})]})]}),e.jsxs("div",{onClick:()=>V(t.id),className:"prose prose-neutral dark:prose-invert max-w-none text-neutral-600 dark:text-slate-300 cursor-pointer flex-1",children:[e.jsx("p",{className:`whitespace-pre-wrap ${L.has(t.id)?"":"line-clamp-6"}`,children:t.content}),!L.has(t.id)&&t.content.length>150&&e.jsx("span",{className:"text-indigo-500 text-sm font-medium hover:underline mt-1 block",children:"Read more"})]}),t.imageUrl&&e.jsx("div",{className:"mt-4 rounded-xl overflow-hidden h-40 w-full bg-neutral-100 dark:bg-slate-900 shrink-0",children:e.jsx(ue,{path:t.imageUrl,alt:"Entry attachment",className:"w-full h-full object-cover"})})]},t.id))}),G&&!w&&x.length>0&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx("button",{onClick:J,className:"bg-white dark:bg-slate-800 text-neutral-600 dark:text-slate-300 px-6 py-2 rounded-full border border-neutral-200 dark:border-slate-700 hover:bg-neutral-50 dark:hover:bg-slate-700 transition-colors shadow-sm",children:"Load More Entries"})}),w&&h>0&&e.jsx("div",{className:"flex justify-center pt-6",children:e.jsx(i,{className:"h-10 w-32 rounded-full"})})]})};export{Le as default};
